(()=>{"use strict";var o={};o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(o){if("object"==typeof window)return window}}();const t=window.ReactDOM,e=window.React,n=window.wp.data,r=window.wp.components,a=window.ReactJSXRuntime,c=function({promotionTarget:o,promoterName:t,description:n,onBlacklistRequest:c,onPromotionInstall:s,onReload:i}){const[d,l]=(0,e.useState)(!1),[p,m]=(0,e.useState)(!1),[u,h]=(0,e.useState)(!1),_=o=>o.charAt(0).toUpperCase()+o.slice(1);return(0,a.jsxs)(r.Card,{className:"dotcamp-promoter-inspector-card",children:[(0,a.jsxs)(r.CardHeader,{className:"dotcamp-promoter-inspector-card__header",children:[(0,a.jsx)("h2",{className:"dotcamp-promoter-inspector-card__header__heading",children:`${_(o)} Plugin`}),(0,a.jsx)(r.Button,{className:"dotcamp-promoter-inspector-card__header__toggle-button",onClick:c,children:(0,a.jsx)(r.Dashicon,{icon:"no-alt"})})]}),(0,a.jsx)(r.CardBody,{className:"dotcamp-promoter-inspector-card__body",children:u?p?(0,a.jsxs)("div",{className:"dotcamp-promoter-inspector-card__body__success",children:[_(o)," ","installed successfully. Save your work and reload this page to start using."]}):(0,a.jsx)("div",{className:"dotcamp-promoter-inspector-card__body__error",children:"An error occurred. Please try again later."}):(0,a.jsxs)("div",{children:[n,(0,a.jsx)(r.Tooltip,{text:`Recommended by ${_(t)}`,placement:"top",children:(0,a.jsx)("span",{children:(0,a.jsx)(r.Dashicon,{className:"dotcamp-promoter-inspector-card__body__info-tooltip-anchor",icon:"info-outline",size:14})})})]})}),(0,a.jsx)(r.CardFooter,{className:"dotcamp-promoter-inspector-card__footer",children:u&&p?(0,a.jsx)(r.Button,{variant:"secondary",onClick:i,children:"Reload"}):(0,a.jsxs)("div",{className:"dotcamp-promoter-inspector-card__footer__install-button-container",children:[(0,a.jsx)(r.Button,{disabled:d,onClick:()=>{l(!0),h(!1),s().then((()=>{m(!0)})).catch((()=>{m(!1)})).finally((()=>{l(!1),h(!0)}))},variant:"secondary",children:"Install"}),d&&(0,a.jsx)("span",{className:"dotcamp-promoter-inspector-card__footer__install-button-container__spinner",children:(0,a.jsx)(r.Dashicon,{icon:"update",size:20})})]})})]})},s=function({targetQuery:o,children:e}){const n=document.querySelector(o);return n?(0,t.createPortal)(e,n):null},i=(0,n.withSelect)((o=>{const{getSelectedBlock:t}=o("core/block-editor");return{activeBlockName:t()?.name}}))((function({promotions:o,portalQuery:t,activeBlockName:n,blackList:r,blacklistAjaxInfo:i,installAjaxInfo:d}){const[l,p]=(0,e.useState)(!1),[m,u]=(0,e.useState)(null),[h,_]=(0,e.useState)([]);return(0,e.useEffect)((()=>{_(r)}),[r]),(0,e.useEffect)((()=>{if(n){const r=(e=n,o.find((o=>o.blocksToUse.includes(e))));r&&(t=r,!h.includes(t.promotionTargetId))?(p(!0),u(r)):(p(!1),u(null))}else p(!1),u(null);var t,e}),[n,h]),l&&(0,a.jsx)(s,{targetQuery:t,children:(0,a.jsx)(c,{description:m.description,promoterName:m.promoterPlugin,promotionTarget:m.promotionTarget,onBlacklistRequest:()=>{const{action:o,nonce:t,url:e}=i,{promotionTargetId:n}=m,r=new FormData;r.append("action",o),r.append("_wpnonce",t),r.append("promotionTargetId",n),h.includes(n)||(_([...h,n]),fetch(e,{method:"POST",body:r}).catch((()=>{})))},onPromotionInstall:()=>{const{action:o,nonce:t,url:e}=d,{promotionTargetId:n}=m,r=new FormData;return r.append("action",o),r.append("_wpnonce",t),r.append("promotionTargetId",n),fetch(e,{method:"POST",body:r}).then((o=>{if(o.ok)return o.json();throw new Error("Network response was not ok.")})).then((o=>{if(o.success)return!0;throw new Error("Response was not successful.")}))},onReload:()=>{window.location.reload()}})})})),d=function(o,t,e){this.action=o,this.nonce=t,this.url=e},l=function(o,t,e,n,r,a){this.promoterPluginId=o,this.promoterPlugin=t,this.promotionTarget=e,this.promotionTargetId=n,this.description=r,this.blocksToUse=a};var p;p={...(o.g||window).dotcampPromoterEditorData},document.addEventListener("DOMContentLoaded",(()=>{const o=document.createRange();o.setStart(document.body,0);const e=o.createContextualFragment('<div id="dotcampPromoterContainer"></div>');document.body.appendChild(e);const n=(0,t.createRoot)(document.getElementById("dotcampPromoterContainer")),{promotions:r,ajax:c,blacklist:s}=p,{blacklist:m,install:u}=c,h=new d(m.action,m.nonce,m.url),_=new d(u.action,u.nonce,u.url),w=r.map((({promoterPluginId:o,promoterPlugin:t,promotionTarget:e,promotionTargetId:n,description:r,blocksToUse:a})=>new l(o,t,e,n,r,a)));n.render((0,a.jsx)(i,{promotions:w,portalQuery:".block-editor-block-inspector",blacklistAjaxInfo:h,blackList:s,installAjaxInfo:_}))}))})();